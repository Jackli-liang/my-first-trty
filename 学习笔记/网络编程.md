# 网络编程基础

### OSI模型和TCP/IP协议介绍

 1. **计算机网络**的介绍和**OSI七层模型**介绍

    **计算机网络**:就是把分布在不同地理区域的计算机以及专门的外部设备利用通信线路互联成一个规模大,功能强的网络系统,从而是众多的计算机可以方便地互相传递信息,共享信息

    **网络分类**:按照地理范围可分为局域网(LAN),城域网(MAN),广域网(WAN)和互联网(Internet)

    **局域网**:通常指几公里以内的,可以通过某种介质互联的计算机,打印机或其他设备的集合,具有距离短,延迟小,数据速率高,传输可靠的特点(公司的所有电脑)

    **城域网**:城域网是一种比局域网更大的网,通常覆盖一个城市,从几十公里到100公里不等,可能会有多种介质,用户的数目比局域网更多,特点:连接距离可以在1-100公里,连接的计算机数量相比较局域网来说更多

    **广域网**:这种网络也称为远程网,所覆盖的范围比城域网更广,它一般是在不同城市之间的LAN或者MAN网络互联,地理范围可从几百公里到几千公里.因为距离较远,信息衰减比较严重,这种网络一般是要租用专线

    **互联网**:网络规模来讲他都是最大的一种网络,及时我们常说的'web',和'万维网'等多种叫法,是全球计算机的互联,特点:不定性,信息量大,传播广

    1.1 **OSI七层参考模型**

    | 7    | 应用层     | 提供应用程序间通信      | 7-5高层负责主机之间的数据传输 |
    | ---- | ---------- | ----------------------- | ----------------------------- |
    | 6    | 表示层     | 处理数据格式,数据加密等 |                               |
    | 5    | 会话层     | 建立,维护和管理会话     |                               |
    | 4    | 传输层     | 建立主机端到端连接      |                               |
    | 3    | 网络层     | 寻址和路由选择          | 3-1底层:负责网络数据传输      |
    | 2    | 数据链路层 | 提供介质访问,链路管理等 |                               |
    | 1    | 物理层     | 比特流传输              |                               |

    OSI参考模型中通过数据封装和解封装过程来实现数据的传输

 2. TCP/IP模型介绍 

    | 应用层     | 提供应用程序网络接口 | HTTP,SMTP,FTP,TELNET,DNS,SSH |
    | ---------- | -------------------- | ---------------------------- |
    | 传输层     | 建立端到端连接       | TCP,UDP,SCTP,MPTCP           |
    | 网络层     | 寻址和路由选择       | IP,ICMP,ARP,RARP             |
    | 数据链路层 | 物理介质访问         |                              |
    | 物理层     | 二进制数据流传输     |                              |

    ***应用层***:

    ​	**HTTP**:超文本传输协议,基于TCP,使用**80**号端口,是用于从WWW服务器传输超文本到本地浏览器的传输协议

    ​	**SMTP**:简单邮件传输协议,基于TCP,使用**25**号端口,是一组用于由源地址到目的地址传送邮件的规则,用来控制信件的发送,中转

    ​	**FTP**:文件传输协议,基于TCP,一般上传下载用于FTP服务,数据端口是**20**号,控制端口是**21**号

    ​	**TELNET**:远程登录协议,基于TCP,使用**23**号端口,是Internet远程登录服务的标准协议和主要方式.为用户提供了在本地计算机上完成远程主机工作的能力.在终端使用者的电脑上使用telnet程序连接到服务器.使用明码传送,保密性差,简单方便.

    ​	**DNS**:域名解析,基于UDP,使用**53**号端口,提供域名到IP地址之间的转换

    ​	**SSH**:安全外壳协议,基于TCP,使用**22**号端口,为建立在应用层和传输层基础上的安全协议.SSH是目前较可靠,专为远程登录会话和其他网络服务提供安全性的协议

    ***传输层***:

    ​	**TCP**:传输控制协议.一种面向连接的,可靠的,基于字节流的传输层通信协议

    ​	**UDP**:用户数据报协议.一种面向无连接的通讯协议,不可靠的,基于报文的传输层通信协议

    ​	**SCTP**:流量传输控制协议,一种面向连接的流传输协议

    ​	**MPTCP**:多路径传输控制协议.TCP的多路径版本.SCTP虽然在首发两端有多条路径,但实际只是使用一条路径传输,当该条路径出现故障时,不需要断开连接,而是转移到其他路径.MPTCP真正意义上实现了多路径并行传输,在连接建立阶段,建立多条路径,然后使用多条路径同时传输数据

    ***网络层***:

    ​	**IP**:Internet协议.通过路由选择将下一条IP封装后交给接口层.IP数据报时无连接服务

    ​	**ICMP**:Internet控制报文协议.是网络层的补充.用于在P主机,路由器之间传递控制消息,检测网络通不通,主机是否可达,路由是否可用等网络本身的消息

    ​	**ARP**:地址解析协议.通过目标设备的IP地址,查询目标设备的MAC地址,以保证通信的顺利进行

    ​	**RARP**:反向地址解析协议

### 认识常见的网络设备

常见的网络设备:笔记本电脑,手机,电视盒子,网络摄像头,无线路由器,交换机,网线

​		企业级路由器,企业级交换机,服务器.存储服务器(磁盘阵列),硬件防火墙,入侵检测系统,入侵防御系统,VPN设备 

### 网络模拟软件Packet Tracer的基本使用

1 Packet Tracer软件安装及介绍

2 初步认识Packet Tracer

3 运用Packet Tracer构建网络扑图

4 配置网络拓扑信息

5 实现网络拓扑的信息传递

------

# 网络编程进阶

### 1 数据链路层编程

**数据链路层概述**:

数据链路层和物理层也称为网络接口层,该层包括主机用于连接网络的网络接口卡(网卡)及其驱动程序,主要处理与传输媒介(如网线,光纤,无线电波等)的物理接口细节

**物理层传输数据**:

发送终端要发的数据会转换为010101的比特流,通过网线,光纤,无线电波传到很远的目的地去.接受终端接受到010101的比特流后,组装成数据帧传递到数据链路层

**数据链路层传输数据**:

网络设备都安装了网卡,数据是从一块网卡传送到另一块网卡

网卡地址就是数据的发送地址和接受地址,也就是数据帧所包含的MAC地址

MAC地址是每块网卡的身份标识,具有全球唯一性.MAC地址采用十六进制标识,共6个字节,前三个字节是厂商编号,后三个字节是网卡流水号,例如4C-0F-6E-12-D2-19

有了MAC地址以后,网络内采用广播形式,把数据发给该子网内所有主机,子网内每台主机在接收到这个包以后,都会读取数据里的目标MAC地址,然后和自己的MAC地址进行对比,如果相同就做下一步处理,如果不同,就丢弃这个包.

1 数据链路层帧格式

PREAMBLE:101010..10          +                  SFD      +          DEST ADDR(目标MAC地址)

SRC ADDR(源MAC地址)+TYPE(标识网络层数据类型)+DATA(64<x<1500字节)  + FCS

**通信方式**:

​	数据以数据帧形式进行通信

​	主机作为数据发送方时,数据链路层负责将来自本机网络层的数据封装为数据帧发送,接受方在收到数据帧之后会给数据发送方发送反馈信息,如果数据传输有误,发送方需要重新发送出错的数据帧.

​	主机作为数据接收方时,数据链路层负责对接受到的数据帧进行CRC校验,并给数据发送方发送反馈信息.如果数据无误,会将接受到的正确帧数据的目标MAC地址,源MAC地址和CRC部分去掉后递交为网络层处理.

​	数据链路层通信使用MAC地址识别主机,主机之间交换数据帧

2 什么是MAC地址,什么是ARP协议

3 通过pustil模块获取通信主机的MAC地址

psutil模块能够轻松实现获取运行的进程和系统利用率(包括CPU,内存,磁盘,网络等)信息.它主要应用于系统监控,分析和限制系统资源及进程的管理

### 2 网络层编程

**网络层概述**:

​	网络层负责获取和维护主机的IP地址,IP地址用于在主机间进行网络互联的标识,网络层负责给数据包选择路由路径

负责点到点(point-to-point)的传输(这里的'点'指主机或路由器)	

1 IP协议概述

​	IP协议位于网络层,它是TCP/IP协议簇中最为核心的协议,所有的上层协议如TCP,UDP数据都以IP数据包格式传输.**特征**:不可靠(不能保证数据包到达),无连接

2 IP地址的划分,子网掩码的作用

​	IP地址分为两个部分:网络和主机段,IP地址分为ABCDE五类地址

​	公有IP地址:可以在互联网当中访问

​	私有IP地址:不能在互联网中使用,只能在校区,学校,公司等局域网使用

​	子网掩码就是判断网络中的计算机在不在同一网络,在就能通,不在就不能通

3 路由器配置路由实例演示

什么是路由器:

​	路由器又称网关设备,专业来说是用于连接多个逻辑上分开网络的一种设备,当数据从一个子网传输到;另一个子网时,可通过路由器的路由功能来完成.

4 什么是ARP协议

为什么要有ARP协议:

​	在网络通讯时,源主机的应用程序知道目的主机的IP地址和端口号,却不知道目的主机的硬件地址,而数据包首先是被网卡接收到再去处理上层协议的,如果接收到的数据包的硬件地址与本机不符,则直接丢弃.因此在通讯前必须获得目的主机的硬件地址

5 什么是ICMP协议

为什么要有ICMP协议:

​	一个新搭建好的网络,往往需要先进行一个简单的测试,来验证网络是否畅通,这个时候就用到ICMP协议了

作用: 1 确认IP包是否成功到达目标地址

​	 2  通知在发送过程中IP包被丢弃的原因

6 通过scapy模块实现ARP,ICMP扫描局域网主机存活状态

### 3 传输层编程

网络层的任务是提供主机到主机的通信,而传输层的任务是提供进程到进程的通信

1 UDP协议和TCP协议概述和区别

1.2 区别

​	UDP面向无连接,不可靠,但因为不用传送许多与数据本身无关的信息,所以效率较高

​	面向连接的TCP协议效率较低,单可靠性高,适合于网络链路不好或可靠性要求高的环境

2 服务器,客户端通信,模型

```yaml
# udp_server.py

import socket
""" 通过socket实现UDP通信协议"""

# 创建socket并指定socket的类型为UDP类型
server = socket.socket(type=socket.SOCK_DGRAM)
# 绑定IP地址并设置端口号
server.bind(('127.0.0.1',1234))
print('这里是慕课网的UDP服务器,端口号为1234.可以进行连接')
# recvfrom方法返回了客户端的地址与端口号,以及服务器端接收到的数据
# 1024代表服务器端接受的数据的长度
data,address = server.recvfrom(1024)
print('客户端的地址信息为%s,客户端的端口号为%s'%(address[0],address[1]),
      '客户端传送的信息为%s'%data.decode('utf8'))
# 向客户端发送数据,address是客户端向服务器端发送数据时,所捕获的地址信息,包含IP地址和端口号
server.sendto('好好学习,天天向上'.encode(),address)
# 关闭服务器
server.close()
# 服务器端保持开启,等待客户端的连接

```

```yaml
# udp_client.py

import socket
""" 通过socket实现UDP通信协议"""

client = socket.socket(type=socket.SOCK_DGRAM)
send_data = input('请输入要向服务器端发送的数据:')
client.sendto(send_data.encode(),('127.0.0.1',1234))
client_data,address = client.recvfrom(1024)

print('慕课网服务器回复的数据为%s'%client_data.decode('utf8'))
client.close()
# 客户端是发起连接
```

3 TCP三次握手,四次挥手问题

标志位: URG紧急标志	ACK确认标志	PSH推标志

​		RST复位标志	SYN同步标志	FIN结束标志

**三次挥手**:

1 客户端发送SYN的数据包到服务器,此时客户端进入SENT状态.等待服务器确认

2 服务器收到SYN数据包之后,在发送SYN+ACK数据包给客户端,进入RECV状态

3 客户端收到SYN+ACK数据包之后,向服务器发送ACK包,进入ESTABISHED状态

完成三次握手,开始传输数据.经过四次挥手之后,断开连接

**四次挥手**:

1 客户端发送FIN+ACK数据包到服务端,此时客户端FIN_WAIT_1,服务器CLOSE_WAIT

2 服务器发送ACK数据包到客户端,此时状态都无变化

3 服务器发送FIN+ACK数据包到客户端,此时服务器LAST_ACK,客户端FIN_WAIT_2

4 客户端发送ACK数据包到服务器,此时客户端TIME_WAIT,服务器CLOSED

------

4 通过UDP协议实现简单聊天室

5 通过TCP协议实现简单服务器,客户端通信模型

5.1 TCP协议的数据传输过程

5.2 通过socket实现TCP通信协议

```yaml
# tcp_server.py

import socket
# 创建服务器的socket,SOCK_STREAM代表TCP
server = socket.socket(type=socket.SOCK_STREAM)
# 绑定IP地址为端口号
address = '127.0.0.1'
port = 1234
server.bind((address,port))
print('TCP服务已经启动,地址为:%s,端口号为:%s'%(address,port))
# 设置最大连接数,必须大于1
server.listen(128)
# 服务器端接受来自客户端的连接(产生新的socket和IP地址)
# 当有客户端连接上来,会从服务端的socket里新建一个socket
# 新的socket用于服务于客户端
new_client,client_adress = server.accept()
print('当前客户端的地址为:%s,端口号为:%s'%(client_adress[0],client_adress[1]))
# accept已经获取了客户端的地址信息,所以使用recv方法
data = new_client.recv(1024)
new_client.send('哈哈哈哈'.encode())
print('服务器端接收到的数据为:%s'%data.encode())
# 先关闭和客户端的连接
# 再关闭服务端的监听socket
new_client.close()
server.close()
```

```yaml
# tcp.client.py

import socket
# 创建客户端的socket,SOCK_STREAM
client = socket.socket(type=socket.SOCK_STREAM)
# 客户端连接服务器
client.connect(('127.0.0.1',1234))
# 给服务器发送数据
client.send('你好'.encode('utf8'))
# 从服务器接收数据
recv_data = client.recv(1024)
print('服务端发送过来的数据为:%s'%recv_data.decode())
client.close()
```

### 4 应用层编程

1 HTTP协议概述,请求格式,方法,状态码

1.1 HTTP概述:

​	HTTP超文本传输协议是互联网上应用最为广泛的一种网络协议,它是基于TCP的应用层协议,客户端和服务端进行通信的一种规则,它的模式非常简单,就是客户端发起请求,服务端响应请求.

1.2 请求格式

1.3 请求方法

GET 从服务器获取指定(请求地址)的资源的信息,它通常只用于读取数据,就想数据库查询一样,不会对资源进行修改

POST  向指定资源提交数据(比如提交表单,上传文件),请求服务器进行处理.数据被包含在请求正文中,这个请求可能会创建新的资源或更新现有的资源

PUT  通过指定资源的唯一标识(在服务器上的具体存放位置),请求服务器创建或更新资源

DELETE  请求服务器删除指定资源

HEAD  与GET方法类似,从服务器获取资源信息.和GET方法不同的是.HEAD不含有呈现数据,仅仅是HTTP头信息.HEAD的好处在于使用这个方法可以在不必传输全部内容的情况下,就可以获得资源的元信息.

OPTIONS  该方法可使服务器传回资源所支持的所有HTTP请求方法

1.4 状态码

​	1xx  消息---请求已被服务接受,继续处理

​	2xx  成功--请求已成功被服务接受,理解,并接受

​	3xx  重定向--需要后续操作才能完成这一请求

​	4xx  请求错误--请求含有语法错误或者无法被执行\

​	5xx  服务器错误--服务器在处理某个正确请求时发送错误

2 通过TCP协议实现静态WEB服务器,并通过浏览器访问

3 从客户端打开浏览器到服务器返回网页,中间过程

3.1 宏观层面:

​	(1)在一个客户端上,打开浏览器,在浏览器的地址栏中,输入www.imooc.com访问慕课网

​	(2)在你敲入网址并按下回车之后,将会发生以下事情:浏览器先尝试从Host文件(它的目录C:\Windows\System32\drivers\etc)中获取http://www.imooc.com/对应的IP地址,如果能取到则直接使用host文件的解析结果

​	(3)如果不能,就是用DNS协议来获取IP.在DNS协议中,PC会向你的本地DNS服务器求助,本地DNS服务器的设置,一种是手动设置的静态IP地址,另一种是通过动态DHCP协议获取的动态IP地址.请求DNS服务器之后,得到慕课网的IP

​	(4)接下来**建立TCP连接**,在TCP协议中,建立TCP需要与慕课网服务器握手三次,你先告诉服务器你要给服务器发东西(SYN),服务器应答你并告诉你它也要给你发东西(SYN,ACK),然后你应答服务器(ACK),总共来回三次,称为3次握手

​	(5)三次握手成功之后,开始用**HTTP协议**请求网页内容.你发个HTTP请求报文给服务器,如果服务器禁止你访问他就给你回个'Forbidden'或者file not found等

​	(6) 如果服务器正常则给你回个"OK",状态码为200并将你要的数据传给你.你收到了服务器的回复,是HTML形式的文本.浏览器必须要能够理解文本的内容,并快速地渲染到屏幕上,渲染出来后,你就看到慕课网的首页了

3.2 微观层面:

​	(1) 域名解析

​	(2) TCP三次握手

​	(3) HTTP传输数据

​	(4) TCP四次挥手

4 DHCP协议,TELNET\SSH协议,SMTP协议

4.1 DHCP动态主机分配协议

​	它是一个局域网的网络协议,使用UDP协议,常用的2个端口:67(DHCP server),68(DHCP client).DHCP通常被用于局域网环境,主要作用是集中的管理,分配IP地址.使client动态的获得IP地址,Gateway地址,DNS服务器地址等信息,并能够提升地址的使用率

4.2 TELNET协议概述:

​	TELNET是一种在UNIX平台上最为人所熟知的网络协议.telnet使用TCP端口23,它是专门为居于昂设计的.Telnet不是一种安全通信协议,因为他并不使用任何安全机制,通过网络传输明文格式的数据,包括密码,所以谁都能嗅探数据包.

4.2 SSH远程访问:

​	SSH是通过互联网访问网络设备和服务器的主要协议.SSH,默认情况下通过TCP22端口运行,该端口号可以更改,SSH是一种非常安全的而协议,因为它共享并发送经过加密的信息,从而为通过互联网等不安全的网络访问的数据提供了机密性和安全性.一旦通讯的数据使用SSH经过加密,就极难解压和读取该数据,所以我们的密码在公共网络上传输也变得很安全.

4.3 SMTP协议:

​	它是一组用于从源地址到目的地址传输邮件的规范,通过它来控制邮件的中转方式.TCP协议的25端口,它帮助每台计算机在发送或中转信件是找到下一个目的地,SMTP服务器就是遵循SMTP协议的发送邮件服务器

